apiVersion: v1
kind: Service
metadata:
  name: nemocheck-plugin-service
  namespace: istio-system
spec:
  selector:
    app: nemocheck-plugin
  ports:
    - name: grpc
      protocol: TCP
      port: 8000
      targetPort: 8000
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nemocheck-plugin
  namespace: istio-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nemocheck-plugin
  template:
    metadata:
      labels:
        app: nemocheck-plugin
    spec:
      containers:
        - name: nemocheck-plugin
          # Built from Dockerfile: docker build -t nemocheck-plugin:latest .
          image: mcpgateway/nemocheck:0.1.0
          env:
            - name: MODEL_NAME
              value: "meta-llama/llama-3-3-70b-instruct"
            - name: CHECK_ENDPOINT
              value: "http://nemo-guardrails-service:8000"
          ports:
            - containerPort: 8000
